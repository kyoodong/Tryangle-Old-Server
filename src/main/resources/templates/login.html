<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>로그인</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>
<body>
<script th:inline="javascript">
    function request_login(id, name) {
        var p = /*[[${_csrf.parameterName}]]*/ 'default'
        var token = /*[[${_csrf.token}]]*/ 'token'

        const form = document.createElement("form")
        form.setAttribute("method", "post")
        form.setAttribute("action", "/login")

        const csrf = document.createElement("input")
        csrf.setAttribute("type", "hidden")
        csrf.setAttribute("name", p)
        csrf.setAttribute("value", token)

        const idInput = document.createElement("input")
        idInput.setAttribute("type", "hidden")
        idInput.setAttribute("name", "username")
        idInput.setAttribute("value", id)

        const nameInput = document.createElement("input")
        nameInput.setAttribute("type", "hidden")
        nameInput.setAttribute("name", "name")
        nameInput.setAttribute("value", name)

        const passwordInput = document.createElement("input")
        passwordInput.setAttribute("type", "hidden")
        passwordInput.setAttribute("name", "password")
        passwordInput.setAttribute("value", "password")

        form.append(csrf)
        form.append(idInput)
        form.append(nameInput)
        form.append(passwordInput)
        document.body.appendChild(form)
        form.submit()
    }

    window.fbAsyncInit = function() {
        FB.init({
            appId      : '626202521583596',
            cookie     : true,
            xfbml      : true,
            version    : 'v7.0'
        });

        FB.AppEvents.logPageView();
        FB.getLoginStatus(function(response) {
            console.log(response)
            // statusChangeCallback(response);

            // 로그인 및 앱 로그인 연결 성공
            if (response.status === 'connected') {
                FB.api(
                    response.authResponse.userID,
                    function (userInfoRes) {
                        console.log(userInfoRes)
                        if (userInfoRes && !userInfoRes.error) {
                            request_login(response.authResponse.userID, userInfoRes.name)
                        }
                    }
                );
            } else {

            }
        });
    };


    function checkLoginState() {
        FB.getLoginStatus(function(response) {
            console.log(response)
            // statusChangeCallback(response);
        });
    }

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/ko_KR/sdk.js#xfbml=1&version=v7.0&appId=1587092474906245&autoLogAppEvents=1" nonce="3pO6SND8"></script>

<div class="main-frame">
    <div class="login-frame">
        <h1>로그인</h1>

        <div class="fb-login-button"
             data-size="large"
             data-button-type="continue_with"
             data-layout="default"
             data-auto-logout-link="false"
             data-use-continue-as="false"
             data-width=""
        onlogin="checkLoginState()"></div>
    </div>
</div>
</body>
</html>